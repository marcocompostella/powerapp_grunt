"use strict";function DialogMonthController(a,b,c){var d=!0;a.list=c.schede.map(function(a){return a.data}),a.indx=c.index,a.$watch("indx",function(c,e){return 1==d?void(d=!1):void b.hide(a.indx)})}function DialogRiposoController(a,b,c,d){function e(){a.time+=1e3,f+=1,f<d.riposo}a.time=(new Date).setHours(0,0,0,0);var f=0;c(e,1e3),a.hide=function(){b.hide()},a.cancel=function(){b.cancel()},a.answer=function(a){b.hide(a)}}angular.module("powerApp",["ui.router","ngAnimate","ngAria","ngMaterial","ngMessages","ngSanitize","ngTouch","ngMdIcons","LocalStorageModule","Login","Main","Dashboard","Engage","Payment","Setting","Training","Store"]).run(["$rootScope","$state","AuthService","CommonService",function(a,b,c,d){a.$on("$stateChangeStart",function(a,e,f,g,h){c.isAuthenticated()?d.changeState(e.name):"Login"!==e.name&&(a.preventDefault(),b.go("Login"))})}]),angular.module("powerApp").constant("API_ENDPOINT",{url:"http://localhost:8181"}).constant("AUTH_EVENTS",{notAuthenticated:"auth-not-authenticated"}).constant("SIDEMENU",[{icon:"dashboard",state:"Dashboard",nested:"Main",type:"l"},{icon:"directions_walk",state:"Training",nested:!1,type:"l"},{icon:"settings",state:"Setting",nested:!1,type:"l"},{icon:"logout",state:"Logout",action:"logout",type:"f"}]).constant("MENU",[{state:"Main",list:[{icon:"settings",label:"Setting"},{icon:"logout",label:"Logout"}]},{state:"Training",list:[{icon:"today",state:"Training",funct:"selMon",label:"Select Month"}]},{state:"Setting",list:[{icon:"logout",label:"Logout"}]}]),angular.module("powerApp").config(["localStorageServiceProvider","$mdThemingProvider","$stateProvider","$urlRouterProvider","$mdDateLocaleProvider","$httpProvider",function(a,b,c,d,e,f){e.formatDate=function(a){return moment(a).format("DD-MM-YYYY")},b.theme("default").primaryPalette("grey").accentPalette("red"),f.interceptors.push("AuthInterceptor"),d.otherwise("/main"),c.state("Main",{url:"/main",views:{"":{templateUrl:"views/main.html",controller:"mainCtrl",controllerAs:"vm"},"Dashboard@Main":{templateUrl:"views/dashboard.html",controller:"dashCtrl",controllerAs:"vm"},"Engage@Main":{templateUrl:"views/engage.html",controller:"engageCtrl",controllerAs:"vm"},"Payment@Main":{templateUrl:"views/payment.html",controller:"paymentCtrl",controllerAs:"vm"}}}).state("Login",{url:"/login",templateUrl:"views/login.html",controller:"loginCtrl"}).state("Setting",{url:"/setting",templateUrl:"views/setting.html",controller:"settingCtrl"}).state("Store",{url:"/store",templateUrl:"views/store.html",controller:"storeCtrl"}).state("Training",{url:"/training",templateUrl:"views/training.html",controller:"trainingCtrl"})}]),angular.module("powerApp").service("CordovaService",["$q","$window",function(a,b){var c=a.defer();this.ready=c.promise,document.addEventListener("deviceready",function(){c.resolve(b.cordova)})}]),angular.module("powerApp").factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(a,b,c){return{responseError:function(d){return a.$broadcast({401:c.notAuthenticated}[d.status],d),b.reject(d)}}}]),angular.module("powerApp").service("CommonService",["$http","$q","CordovaService","AuthService","TrainingService","API_ENDPOINT",function(a,b,c,d,e,f){var g=this;g.start=!1,g.controllers=new Array;var h=function(){g.start=!0,a.get(f.url+"/mobileInfo").then(function(a){d.changeLoginStatus(!0);var b;b=a.data.collections.map(function(a){return a.type}).indexOf("userinfo"),g.userinfo=a.data.collections[b].userInfo,b=a.data.collections.map(function(a){return a.type}).indexOf("photo"),g.photo=a.data.collections[b].img,g.setPhoto&&g.setPhoto(g.photo),e.init(g.userinfo.scheda)})},i=function(a){d.setLoginStatus(a)},j=function(){d.logout()},k=function(a){g.view.menus.forEach(function(b){b.state==a&&(g.view.menu=b.list)})},l=function(){e.popMonth()},m=function(a){console.log("w: ",a)},n=function(a){console.log("l: ",a)},o=function(a,b){var c=new FileUploadOptions,e=new FileTransfer,g={Authorization:d.getHeaderAuth()};c.fileKey="file",c.fileName=a.substr(a.lastIndexOf("/")+1),c.mimeType="image/jpeg",c.chunkedMode=!0,c.params={userid:b},c.headers=g,console.log(a),e.upload(a,encodeURI(f.url+"/mobileUpPhoto"),m,n,c)},p=function(a){console.log("notificationOpenedCallback: "+JSON.stringify(a))};c.ready.then(function(){window.plugins.OneSignal.startInit("cd0dc958-90b1-437b-8ff5-09d6211a1a70","949075032282").handleNotificationOpened(p).endInit(),window.plugins.OneSignal.getIds(function(a){console.log(a)})});var q=function(a){if(g.controllers.indexOf(a)>=0)switch(a){case"Dashboard":g.setPhoto(g.photo)}else g.controllers.push(a)},r=function(){return g.user},s=function(){return g.photo},t=function(a){g.setPhoto=a},u=function(a){g.user=a},v=function(a){g.view=a},w=function(){return g.start};return{init:h,start:q,isStart:w,setMenu:v,setUser:u,getUser:r,getPhoto:s,setPhoto:t,wrapAuth:i,sendAvatar:o,changeState:k,choseMonth:l,logout:j}}]),angular.module("powerApp").service("AuthService",["$rootScope","$http","$q","API_ENDPOINT","localStorageService",function(a,b,c,d,e){function f(){var a=e.get(l);a&&h(a)}function g(a){e.set(l,a),h(a)}function h(a){j=a,b.defaults.headers.common.Authorization=j}function i(){j=void 0,m=!1,b.defaults.headers.common.Authorization=void 0,e.remove(l)}var j,k=this,l="tokenKey",m=!1,n=function(a){return c(function(c,e){b.post(d.url+"/mobileAuth",a).then(function(a){a.data.success?(m=!0,k.view.isLogged=!0,g(a.data.token),c(a.data.user)):e(a.data.msg)})})},o=function(a){k.view=a},p=function(a){k.view.isLogged=a},q=function(){k.view.isLogged=!1,i()},r=function(){return j};return f(),{setLoginStatus:o,changeLoginStatus:p,login:n,logout:q,getHeaderAuth:r,isAuthenticated:function(){return m}}}]),angular.module("powerApp").service("TrainingService",["$q","$http","$mdDialog","API_ENDPOINT",function(a,b,c,d){var e=this,f=function(a){e.schede=a,e.index=0,g(a[a.length-1]).then(function(a){e.scheda=a})},g=function(c){return a(function(a,e){b.post(d.url+"/mobileScheda",c).then(function(b){b.data.success?a(b.data.scheda):e()})})},h=function(a){e.view=a,a.scheda=e.scheda},i=function(){c.show({clickOutsideToClose:!1,fullscreen:!1,parent:angular.element(document.body),templateUrl:"views/dialogMonth.html",controller:DialogMonthController,resolve:{training:function(){return{schede:e.schede,index:e.index}}}}).then(function(a){g(e.schede[a]).then(function(b){e.index=a,e.view.scheda=b})},function(){})};return{init:f,bindScheda:h,popMonth:i}}]),DialogMonthController.$inject=["$scope","$mdDialog","training"],angular.module("powerApp").controller("appCtrl",["$scope","$mdSidenav","$state","CommonService","AUTH_EVENTS","SIDEMENU","MENU",function(a,b,c,d,e,f,g){function h(){b("left").toggle()}function i(){window.history.back()}function j(a){k.selected=a;var b=a.state;if("l"===a.type)a.nested!==!1&&(b=a.nested),c.go(b);else if("f"===a.type)switch(a.action){case"logout":k.logout()}}var k=this;a.view={sidemenu:f,menus:g,isLogged:!1},d.wrapAuth(a.view),d.setMenu(a.view),a.$on(e.notAuthenticated,function(){k.logout()}),this.openMenu=function(a,b){a(b)},this.selectMenu=function(a){switch(a.state){case"Training":d.choseMonth(a.funct)}},k.logout=function(){d.logout(),c.go("Login")},k.selectItem=j,k.toggleList=h,k.back=i}]),angular.module("Login",[]).controller("loginCtrl",["$scope","$state","AuthService","CommonService",function(a,b,c,d){a.login={username:"",password:"",remember:!1},a.loginPost=function(){c.login(a.login).then(function(a){d.init(),d.setUser(a),b.go("Main")},function(){})},a.clear=function(){a.login={remember:!1}}}]),angular.module("Main",[]).controller("mainCtrl",["CommonService",function(a){}]),angular.module("Dashboard",["ngRateIt"]).controller("dashCtrl",["$scope","$state","CordovaService","CommonService","TrainingService",function(a,b,c,d,e){function f(){navigator.camera.cleanup()}function g(b){d.sendAvatar(b,a.user._id).then(function(a){f()})}function h(a){console.log("FileSystem Error"),console.dir(a)}a.model={basic:0,readonly:2.5,readonly_enables:!0,minMaxStep:6,minMaxStep2:8.75,pristine:3,resetable:4,heightWidth:1.5,callbacks:5,custom:4},a.user=d.getUser();var i=function(b){a.avatar=b};d.setPhoto(i);var j,k,l;a.getPicture=function(){navigator.camera.getPicture(g,h,{quality:100,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG})},a.send=function(){var b=cordova.file.externalDataDirectory+"test.jpg";d.sendAvatar(b,a.user._id)},a.read=function(){console.log("path:"),console.log(cordova.file.dataDirectory),window.resolveLocalFileSystemURL(cordova.file.dataDirectory+"/log.txt",gotFile,fail)},c.ready.then(function(){j=navigator.camera.PictureSourceType,k=navigator.camera.DestinationType,l=navigator.camera}),a.startTraining=function(){b.go("Training")},d.start("Dashboard")}]),angular.module("Engage",[]).controller("engageCtrl",function(){}),angular.module("Payment",[]).controller("paymentCtrl",function(){}),angular.module("Setting",[]).controller("settingCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("Training",["swipeLi"]).controller("trainingCtrl",["$scope","$mdDialog","TrainingService",function(a,b,c){c.bindScheda(a),a.done=function(c,d){b.show({controller:DialogRiposoController,templateUrl:"views/dialogRiposo.html",parent:angular.element(document.body),targetEvent:c,clickOutsideToClose:!0,fullscreen:!0,resolve:{data:function(){return{riposo:d.riposo}}}}).then(function(b){a.status='You said the information was "'+b+'".'},function(){a.status="You cancelled the dialog."})},a.skip=function(a){console.log("%s marked as rejected!",a)}}]),DialogRiposoController.$inject=["$scope","$mdDialog","$interval","data"],angular.module("Store",[]).controller("storeCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("powerApp").run(["$templateCache",function(a){a.put("views/accept-content.html",'<ng-md-icon icon="done"></ng-md-icon>'),a.put("views/dashboard.html",'<md-content layout="column" layout-fill layout-align="start center"> <img ng-src="data:image/jpeg;base64,{{avatar}}" class="image" ng-click="getPicture()"> <md-button ng-click="read()">read</md-button> <md-button ng-click="send()">send</md-button> <ng-rate-it min="0" max="5" ng-model="model.resetable" resetable="false"></ng-rate-it> <p>{{user.nome}} {{user.cognome}}</p> <md-content ng-if="1==2"> <md-card> <md-card-title> <md-card-title-text> <span class="md-headline">Action required</span> </md-card-title-text> </md-card-title> <md-card-content> <p> status payment </p> <p> status scheda </p> </md-card-content> <md-card-actions layout="row" layout-align="end end"> <md-button>Action 1</md-button> </md-card-actions> </md-card> </md-content> <md-fab-speed-dial md-direction="up" md-open="false" class="md-scale md-fab-bottom-right md-hover-full speed-dial"> <md-fab-trigger> <md-button class="md-fab"> <ng-md-icon icon="bubble_chart"></ng-md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button class="md-fab md-mini" ng-click="startTraining()"> <ng-md-icon icon="play_arrow"></ng-md-icon> <md-tooltip md-direction="left">Start training</md-tooltip> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-content>'),a.put("views/dialogMonth.html",'<md-dialog> <md-dialog-content> <div class="md-dialog-content"> Select training: </div> </md-dialog-content> <md-dialog-actions layout="column" layout-align="start start"> <md-radio-group ng-model="indx"> <md-radio-button ng-repeat="item in list" value="{{$index}}"> {{item|date:\'MMM/yy\'}} </md-radio-button> </md-radio-group> </md-dialog-actions> </md-dialog>'),a.put("views/dialogRiposo.html","<md-dialog> <md-dialog-content> <div class=\"md-dialog-content\"> <p>Timer: {{ time | date:'mm:ss'}}</p> </div> </md-dialog-content> <md-dialog-actions> </md-dialog-actions> </md-dialog>"),a.put("views/engage.html","<p>This is the Engage view.</p>"),a.put("views/login.html",'<md-content flex layout="row" layout-align="center center"> <md-card> <md-card-content flex> <section layout="column" layout-sm="column" layout-align="center center" layout-wrap> <md-input-container> <label>Username</label> <input ng-model="login.username"> </md-input-container> <md-input-container> <label>Password</label> <input ng-model="login.password" type="password"> </md-input-container> </section> <section layout="column" layout-sm="row" layout-align="center center" layout-wrap> <md-checkbox ng-model="login.remember">Remember me</md-checkbox> </section> <section layout="row" layout-sm="row" layout-align="center center" layout-wrap> <md-button ng-click="loginPost()" class="md-raised md-primary">Login</md-button> <md-button ng-click="clear()" class="md-raised md-primary">Clear</md-button> </section> </md-card-content> </md-card> </md-content>'),a.put("views/main.html",'<md-content> <md-tabs md-dynamic-height md-border-bottom md-swipe-content="true" md-selected="selectedIndex"> <md-tab label="Dashboard"> <md-content class="md-padding"> <div ui-view="Dashboard"></div> </md-content> </md-tab> <md-tab label="Engage"> <md-content class="md-padding"> <div ui-view="Engage"></div> </md-content> </md-tab> <md-tab label="Payment"> <md-content class="md-padding"> <div ui-view="Payment"></div> </md-content> </md-tab> </md-tabs> </md-content>'),a.put("views/payment.html","<p>This is the payment view.</p>"),a.put("views/reject-content.html",'<ng-md-icon icon="clear"></ng-md-icon>'),a.put("views/sample-content.html",'<div class="main-content"> <h4>{{eser.nome}}<br> {{eser.serie}} * {{eser.ripetizioni}} </h4></div>'),a.put("views/setting.html","<p>This is the setting view.</p>"),a.put("views/store.html","<p>This is the store view.</p>"),a.put("views/training.html",'<md-tabs md-dynamic-height md-border-bottom md-swipe-content="true" md-selected="selectedIndex"> <md-tab label="{{day.title}}" ng-repeat="day in scheda.day"> <md-content class="md-padding"> <md-content style="height: 600px"> <section ng-repeat="grp in day.gruppi"> <md-subheader class="md-primary">{{grp.nome}}</md-subheader> <div ng-repeat="eser in grp.esercizi"> <div swipe-li class="item" disabled intent="true" accept="done($event,eser)" reject="skip($event,eser)" main-content="\'views/sample-content.html\'" accept-content="\'views/accept-content.html\'" reject-content="\'views/reject-content.html\'" reset-to-content="false" ng-class="{invert: item.doInvert}"></div> </div> <!--\r\n           <md-list layout-padding >\r\n             <md-list-item class="md-2-line" ng-repeat="eser in grp.esercizi">\r\n                  <div class="md-list-item-text">\r\n                    <h3>{{eser.nome}}</h3>\r\n                    <h4>{{eser.serie}} * {{eser.ripetizioni}}</h4>\r\n                  </div>\r\n             </md-list-item>\r\n           </md-list>\r\n--> </section> </md-content> </md-content> </md-tab> </md-tabs>')}]);